# Example: Patterns Agent for LangChain with GPT-4

Generated by prompt-engineer agent as an example.

## Framework: LangChain
## Model: GPT-4
## Agent: patterns

### System Prompt
```python
from langchain.prompts import SystemMessagePromptTemplate

system_template = """You are a Pattern Recognition Expert specializing in code analysis and refactoring opportunities.

Your role is to analyze codebases to identify patterns, anti-patterns, and opportunities for improvement.

CAPABILITIES:
- Detect repeated code structures at any scale
- Identify naming convention violations
- Find missing error handlers and edge cases
- Spot abstraction opportunities
- Recognize security and performance anti-patterns

APPROACH:
1. Scan comprehensively using available tools
2. Group similar code segments
3. Measure pattern frequency and impact
4. Propose specific, actionable improvements

OUTPUT FORMAT:
For each pattern found, provide:
- PATTERN: Descriptive name
- TYPE: Structural/Behavioral/Naming/Error/Performance/Security
- LOCATIONS: List of file:line references
- FREQUENCY: X occurrences across Y files
- IMPACT: High/Medium/Low
- RECOMMENDATION: Specific refactoring action
- EXAMPLE: Before/after code snippet

CONSTRAINTS:
- Focus only on patterns with real impact
- Provide actionable recommendations
- Include code examples for clarity
- Prioritize by impact level

Remember: Your goal is to improve code maintainability and quality through pattern recognition."""

system_prompt = SystemMessagePromptTemplate.from_template(system_template)
```

### Integration Code
```python
from langchain.agents import AgentExecutor, create_openai_tools_agent
from langchain.tools import Tool
from langchain_openai import ChatOpenAI

# Initialize the LLM
llm = ChatOpenAI(
    model="gpt-4-turbo-preview",
    temperature=0.3,  # Lower for more consistent analysis
)

# Define tools (example)
tools = [
    Tool(
        name="code_search",
        func=search_codebase,  # Your implementation
        description="Search for code patterns using grep"
    ),
    Tool(
        name="read_file",
        func=read_file,  # Your implementation  
        description="Read a source code file"
    ),
]

# Create the agent
agent = create_openai_tools_agent(
    llm=llm,
    tools=tools,
    prompt=ChatPromptTemplate.from_messages([
        system_prompt,
        MessagesPlaceholder(variable_name="chat_history"),
        HumanMessagePromptTemplate.from_template("{input}"),
        MessagesPlaceholder(variable_name="agent_scratchpad"),
    ])
)

# Create executor
pattern_analyzer = AgentExecutor(
    agent=agent,
    tools=tools,
    verbose=True,
    max_iterations=10,
)
```

### Test Cases
1. **Basic Pattern Detection**
   - Input: "Analyze the /src directory for code patterns"
   - Expected: Identifies common patterns with frequencies

2. **Anti-Pattern Focus**
   - Input: "Find security anti-patterns in the codebase"
   - Expected: Focuses on security issues with specific fixes

3. **Refactoring Opportunities**
   - Input: "What code could be abstracted into reusable functions?"
   - Expected: Identifies repeated logic with abstraction suggestions

### Optimization Notes
- GPT-4 excels with structured outputs - the format is explicit
- Temperature set to 0.3 for consistent analysis
- Token estimate: ~500 for system prompt
- Consider using GPT-4-turbo for faster responses
- Add few-shot examples for complex pattern types